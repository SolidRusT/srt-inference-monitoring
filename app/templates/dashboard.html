<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Performance Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <h1>Performance Dashboard</h1>
    <div id="charts">
      <canvas id="cpuUsageChart"></canvas>
      <canvas id="memoryUsageChart"></canvas>
      <canvas id="gpuUsageChart"></canvas>
      <canvas id="diskUsageChart"></canvas>
      <canvas id="networkIOChart"></canvas>
    </div>
    <script>
      async function fetchMetrics() {
          const response = await fetch('/api/metrics');
          const data = await response.json();
          return data;
      }

      function updateCharts(metrics) {
        const cpuUsageData = [];
        const memoryUsageData = [];
        const gpuUsageData = [];
        const diskUsageData = [];
        const networkIOData = [];
        const labels = Object.keys(metrics);

        labels.forEach((server) => {
          cpuUsageData.push(metrics[server].cpu_usage);
          memoryUsageData.push(metrics[server].memory_usage);
          gpuUsageData.push(metrics[server].gpu_usage);
          diskUsageData.push(metrics[server].disk_usage);
          networkIOData.push(metrics[server].network_io);
        });

        cpuUsageChart.data.labels = labels;
        cpuUsageChart.data.datasets[0].data = cpuUsageData;
        cpuUsageChart.update();

        memoryUsageChart.data.labels = labels;
        memoryUsageChart.data.datasets[0].data = memoryUsageData;
        memoryUsageChart.update();

        gpuUsageChart.data.labels = labels;
        gpuUsageChart.data.datasets[0].data = gpuUsageData;
        gpuUsageChart.update();

        diskUsageChart.data.labels = labels;
        diskUsageChart.data.datasets[0].data = diskUsageData;
        diskUsageChart.update();

        networkIOChart.data.labels = labels;
        networkIOChart.data.datasets[0].data = networkIOData;
        networkIOChart.update();
    }

      const cpuUsageChart = new Chart(
        document.getElementById("cpuUsageChart"),
        {
          type: "bar",
          data: {
            labels: [],
            datasets: [
              {
                label: "CPU Usage",
                data: [],
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                borderColor: "rgba(75, 192, 192, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        }
      );

      const memoryUsageChart = new Chart(
        document.getElementById("memoryUsageChart"),
        {
          type: "bar",
          data: {
            labels: [],
            datasets: [
              {
                label: "Memory Usage",
                data: [],
                backgroundColor: "rgba(153, 102, 255, 0.2)",
                borderColor: "rgba(153, 102, 255, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        }
      );

      const gpuUsageChart = new Chart(
        document.getElementById("gpuUsageChart"),
        {
          type: "bar",
          data: {
            labels: [],
            datasets: [
              {
                label: "GPU Usage",
                data: [],
                backgroundColor: "rgba(255, 159, 64, 0.2)",
                borderColor: "rgba(255, 159, 64, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        }
      );

      const diskUsageChart = new Chart(document.getElementById('diskUsageChart'), {
        type: 'bar',
        data: {
            labels: [],
            datasets: [{
                label: 'Disk Usage',
                data: [],
                backgroundColor: 'rgba(255, 206, 86, 0.2)',
                borderColor: 'rgba(255, 206, 86, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
      });

      const networkIOChart = new Chart(document.getElementById('networkIOChart'), {
        type: 'bar',
        data: {
            labels: [],
            datasets: [{
                label: 'Network I/O',
                data: [],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
      });

      async function update() {
        const metrics = await fetchMetrics();
        updateCharts(metrics);
      }

      update();
      setInterval(update, 30000); // Update every 30 seconds
    </script>
  </body>
</html>
